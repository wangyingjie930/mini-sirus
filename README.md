# Mini-Sirus - ä»»åŠ¡ç³»ç»Ÿ

åŸºäº **Clean Architectureï¼ˆç®€æ´æ¶æ„ï¼‰** è®¾è®¡çš„ä»»åŠ¡ç³»ç»Ÿï¼Œç”¨äºç®¡ç†æ´»åŠ¨ä»»åŠ¡ã€ç”¨æˆ·è¿›åº¦ã€å¥–åŠ±å‘æ”¾ç­‰ä¸šåŠ¡åœºæ™¯ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨ç®€æ´æ¶æ„ï¼ˆClean Architectureï¼‰è®¾è®¡ï¼Œéµå¾ªä¾èµ–å€’ç½®åŸåˆ™ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºæ¡†æ¶å’ŒåŸºç¡€è®¾æ–½ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Interface Layer                 â”‚  HTTP/gRPC/Event Handlers
â”‚         (å¤–éƒ¨æ¥å£å±‚)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Adapter Layer (é€‚é…å™¨å±‚)           â”‚  Repository/RuleEngine/Observer
â”‚      å®ç°è¾“å‡ºç«¯å£                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ implements
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Use Case Layer (ç”¨ä¾‹å±‚)            â”‚  ä¸šåŠ¡æµç¨‹ç¼–æ’
â”‚      å®šä¹‰è¾“å…¥/è¾“å‡ºç«¯å£                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Domain Layer (é¢†åŸŸå±‚)              â”‚  å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸäº‹ä»¶
â”‚      æ ¸å¿ƒä¸šåŠ¡è§„åˆ™                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›®å½•ç»“æ„

```
mini-sirus/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ example/              # ç¤ºä¾‹ç¨‹åºå…¥å£
â”‚       â””â”€â”€ main.go
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/               # é¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ entity/           # å®ä½“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ valueobject/      # å€¼å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ event/            # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â””â”€â”€ repository/       # ä»“å‚¨æ¥å£å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ usecase/              # ç”¨ä¾‹å±‚ - ä¸šåŠ¡æµç¨‹ç¼–æ’
â”‚   â”‚   â”œâ”€â”€ task/             # ä»»åŠ¡ç›¸å…³ç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ dto/              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â””â”€â”€ port/             # ç«¯å£å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ input/        # è¾“å…¥ç«¯å£ï¼ˆæœåŠ¡æ¥å£ï¼‰
â”‚   â”‚       â””â”€â”€ output/       # è¾“å‡ºç«¯å£ï¼ˆä¾èµ–æ¥å£ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ adapter/              # é€‚é…å™¨å±‚ - å®ç°è¾“å‡ºç«¯å£
â”‚   â”‚   â”œâ”€â”€ repository/       # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ memory/       # å†…å­˜å®ç°
â”‚   â”‚   â”œâ”€â”€ rule_engine/      # è§„åˆ™å¼•æ“é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ observer/         # è§‚å¯Ÿè€…å®ç°
â”‚   â”‚   â””â”€â”€ notification/     # é€šçŸ¥æœåŠ¡é€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/       # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logger/           # æ—¥å¿—
â”‚   â”‚   â””â”€â”€ lock/             # åˆ†å¸ƒå¼é”
â”‚   â”‚
â”‚   â””â”€â”€ interface/            # æ¥å£å±‚ - å¤–éƒ¨è®¿é—®å…¥å£
â”‚       â””â”€â”€ http/             # HTTPæ¥å£
â”‚           â”œâ”€â”€ handler/      # å¤„ç†å™¨
â”‚           â””â”€â”€ router/       # è·¯ç”±
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ CLEAN_ARCHITECTURE.md # æ¶æ„è¯¦ç»†æ–‡æ¡£
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
go mod download
```

### è¿è¡Œç¤ºä¾‹

```bash
go run cmd/example/main.go
```

ç¤ºä¾‹ç¨‹åºæ¼”ç¤ºäº†ä»¥ä¸‹åŠŸèƒ½ï¼š
1. åˆ›å»ºä»»åŠ¡
2. è§¦å‘å‘å¸ƒä»»åŠ¡
3. åˆ›å»ºç­¾åˆ°ä»»åŠ¡
4. è§¦å‘ç­¾åˆ°ä»»åŠ¡
5. æŸ¥è¯¢ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨
6. æ´»åŠ¨ç®¡ç†

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

### 1. é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰

**ä½ç½®**: `internal/domain/`

- **å®ä½“ï¼ˆEntityï¼‰**: å…·æœ‰å”¯ä¸€æ ‡è¯†å’Œç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡
  - `ActUserTask`: ç”¨æˆ·ä»»åŠ¡å®ä½“
  - `ActUserTaskDetail`: ä»»åŠ¡æ˜ç»†å®ä½“
  - `ActActivity`: æ´»åŠ¨å®ä½“

- **å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰**: ä¸å¯å˜çš„æè¿°æ€§å¯¹è±¡
  - `TaskType`: ä»»åŠ¡ç±»å‹
  - `Expression`: è¡¨è¾¾å¼

- **ä»“å‚¨æ¥å£ï¼ˆRepositoryï¼‰**: å®šä¹‰æ•°æ®è®¿é—®æŠ½è±¡
  - `TaskRepository`
  - `TaskDetailRepository`
  - `ActivityRepository`

### 2. ç”¨ä¾‹å±‚ï¼ˆUse Case Layerï¼‰

**ä½ç½®**: `internal/usecase/`

- **ä¸šåŠ¡ç”¨ä¾‹**:
  - `TriggerTaskUseCase`: è§¦å‘ä»»åŠ¡ç”¨ä¾‹
  - `CreateTaskUseCase`: åˆ›å»ºä»»åŠ¡ç”¨ä¾‹
  - `QueryTaskUseCase`: æŸ¥è¯¢ä»»åŠ¡ç”¨ä¾‹

- **ç«¯å£å®šä¹‰**:
  - è¾“å…¥ç«¯å£: å¯¹å¤–æä¾›çš„æœåŠ¡æ¥å£
  - è¾“å‡ºç«¯å£: ä¾èµ–çš„å¤–éƒ¨æœåŠ¡æ¥å£

### 3. é€‚é…å™¨å±‚ï¼ˆAdapter Layerï¼‰

**ä½ç½®**: `internal/adapter/`

å®ç°ç”¨ä¾‹å±‚å®šä¹‰çš„è¾“å‡ºç«¯å£ï¼š
- `TaskRepositoryMemory`: å†…å­˜ä»“å‚¨å®ç°
- `GovaluateAdapter`: è§„åˆ™å¼•æ“é€‚é…å™¨
- `TaskObserverRegistry`: è§‚å¯Ÿè€…æ³¨å†Œè¡¨
- `ReachAdapter`: è§¦è¾¾æœåŠ¡é€‚é…å™¨

### 4. åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰

**ä½ç½®**: `internal/infrastructure/`

æä¾›æŠ€æœ¯åŸºç¡€è®¾æ–½ï¼š
- é…ç½®ç®¡ç†
- æ—¥å¿—ç³»ç»Ÿ
- åˆ†å¸ƒå¼é”

### 5. æ¥å£å±‚ï¼ˆInterface Layerï¼‰

**ä½ç½®**: `internal/interface/`

å¤„ç†å¤–éƒ¨è¯·æ±‚ï¼š
- HTTP å¤„ç†å™¨
- è·¯ç”±é…ç½®

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºä»»åŠ¡

```go
createInput := dto.CreateTaskInput{
    ActivityID:   1,
    TaskID:       100,
    UserID:       12345,
    Target:       3,
    TaskType:     valueobject.TaskTypePublishTimes,
    TaskCondExpr: "WITH_ANY_TOPIC(tag_ids, [1001, 1002]) && LIKE_COUNT_GTE(like_count, 10)",
}

taskOutput, err := container.CreateTaskUC.Execute(ctx, createInput)
```

### è§¦å‘ä»»åŠ¡

```go
publishEvent := &dto.PublishEventDTO{
    UserID:       12345,
    ContentID:    999,
    TopicIDs:     []uint64{1001, 1003},
    LikeCount:    15,
    IsAudited:    true,
}

triggerInput := dto.TriggerTaskInput{
    TaskMode: publishEvent,
}

err := container.TriggerTaskUseCase.Execute(ctx, triggerInput)
```

### æŸ¥è¯¢ä»»åŠ¡

```go
tasks, err := container.QueryTaskUC.ExecuteList(ctx, userID)
```

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

1. **æ¸…æ™°çš„ä¾èµ–æ–¹å‘**: å†…å±‚ä¸ä¾èµ–å¤–å±‚ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤
2. **é«˜åº¦å¯æµ‹è¯•**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•ï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨æœåŠ¡
3. **æŠ€æœ¯æ— å…³**: å¯è½»æ¾æ›¿æ¢æ•°æ®åº“ã€æ¡†æ¶ç­‰æŠ€æœ¯å®ç°
4. **æ˜“äºç»´æŠ¤**: èŒè´£æ˜ç¡®ï¼Œä¿®æ”¹å½±å“èŒƒå›´å°
5. **ä¾¿äºæ‰©å±•**: æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ æ–°çš„ç”¨ä¾‹å’Œé€‚é…å™¨

## ğŸ“š è¯¦ç»†æ–‡æ¡£

æ›´å¤šæ¶æ„ç»†èŠ‚è¯·å‚è€ƒï¼š
- [ç®€æ´æ¶æ„è¯¦ç»†è¯´æ˜](CLEAN_ARCHITECTURE.md)

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.24+
- **è§„åˆ™å¼•æ“**: govaluate
- **æ¶æ„æ¨¡å¼**: Clean Architecture
- **è®¾è®¡æ¨¡å¼**: Repository, Observer, Adapter, Dependency Injection

## ğŸ“ å¼€å‘è§„èŒƒ

### å‘½åè§„èŒƒ
- æ–‡ä»¶: å°å†™+ä¸‹åˆ’çº¿ `task_repository.go`
- åŒ…: å°å†™å•è¯ `package entity`
- æ¥å£: ä¸ä½¿ç”¨ `I` å‰ç¼€
- å®ç°: å¸¦åç¼€ `TaskRepositoryMemory`

### ä¾èµ–è§„åˆ™
- Domain å±‚ï¼šä¸ä¾èµ–ä»»ä½•å…¶ä»–å±‚
- Use Case å±‚ï¼šåªä¾èµ– Domain å±‚
- Adapter å±‚ï¼šä¾èµ– Use Case å’Œ Domain å±‚
- Infrastructure å±‚ï¼šå¯è¢«ä»»ä½•å±‚ä½¿ç”¨
- Interface å±‚ï¼šä¾èµ– Use Case å±‚

### æµ‹è¯•ç­–ç•¥
- Domain å±‚ï¼šçº¯å•å…ƒæµ‹è¯•ï¼Œæ— éœ€ Mock
- Use Case å±‚ï¼šMock è¾“å‡ºç«¯å£ï¼Œæµ‹è¯•ä¸šåŠ¡æµç¨‹
- Adapter å±‚ï¼šé›†æˆæµ‹è¯•
- Interface å±‚ï¼šE2E æµ‹è¯•

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

