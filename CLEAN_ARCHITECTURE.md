# Mini-Sirus ç®€æ´æ¶æ„é‡æ„æ–¹æ¡ˆ

## ğŸ“ æ¶æ„åŸåˆ™

åŸºäº Clean Architectureï¼ˆç®€æ´æ¶æ„ï¼‰è®¾è®¡ï¼Œéµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

1. **ä¾èµ–å€’ç½®**ï¼šå†…å±‚ä¸ä¾èµ–å¤–å±‚ï¼Œä¾èµ–æ–¹å‘æŒ‡å‘å†…å±‚
2. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½åˆ†ç¦»
3. **å¯æµ‹è¯•æ€§**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºå¤–éƒ¨ä¾èµ–
4. **æ¡†æ¶ç‹¬ç«‹**ï¼šä¸ä¾èµ–å…·ä½“çš„æ¡†æ¶å®ç°

## ğŸ—ï¸ ç›®å½•ç»“æ„

```
mini-sirus/
â”œâ”€â”€ cmd/                          # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ api/                      # APIæœåŠ¡å…¥å£
â”‚       â””â”€â”€ main.go
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰- æœ€å†…å±‚
â”‚   â”‚   â”œâ”€â”€ entity/               # å®ä½“å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task.go          # ä»»åŠ¡å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ activity.go      # æ´»åŠ¨å®ä½“
â”‚   â”‚   â”‚   â””â”€â”€ user.go          # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”œâ”€â”€ valueobject/         # å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_type.go    # ä»»åŠ¡ç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ task_status.go  # ä»»åŠ¡çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ expression.go   # è¡¨è¾¾å¼
â”‚   â”‚   â”œâ”€â”€ event/               # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ task_completed.go
â”‚   â”‚   â”‚   â””â”€â”€ task_progress_updated.go
â”‚   â”‚   â””â”€â”€ repository/          # ä»“å‚¨æ¥å£ï¼ˆåªæœ‰æ¥å£å®šä¹‰ï¼‰
â”‚   â”‚       â”œâ”€â”€ task_repository.go
â”‚   â”‚       â””â”€â”€ activity_repository.go
â”‚   â”‚
â”‚   â”œâ”€â”€ usecase/                 # ç”¨ä¾‹å±‚ï¼ˆUse Case Layerï¼‰
â”‚   â”‚   â”œâ”€â”€ task/                # ä»»åŠ¡ç”¨ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ trigger_task.go     # è§¦å‘ä»»åŠ¡ç”¨ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ create_task.go      # åˆ›å»ºä»»åŠ¡ç”¨ä¾‹
â”‚   â”‚   â”‚   â””â”€â”€ query_task.go       # æŸ¥è¯¢ä»»åŠ¡ç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ activity/            # æ´»åŠ¨ç”¨ä¾‹
â”‚   â”‚   â”‚   â””â”€â”€ manage_activity.go
â”‚   â”‚   â”œâ”€â”€ port/                # ç«¯å£ï¼ˆæ¥å£å®šä¹‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ input/           # è¾“å…¥ç«¯å£ï¼ˆUse Caseæ¥å£ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ task_service.go
â”‚   â”‚   â”‚   â””â”€â”€ output/          # è¾“å‡ºç«¯å£ï¼ˆå¤–éƒ¨ä¾èµ–æ¥å£ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ task_repo.go
â”‚   â”‚   â”‚       â”œâ”€â”€ notification_service.go
â”‚   â”‚   â”‚       â””â”€â”€ rule_engine.go
â”‚   â”‚   â””â”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ task_dto.go
â”‚   â”‚       â””â”€â”€ event_dto.go
â”‚   â”‚
â”‚   â”œâ”€â”€ adapter/                 # é€‚é…å™¨å±‚ï¼ˆInterface Adapters Layerï¼‰
â”‚   â”‚   â”œâ”€â”€ repository/          # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ memory/          # å†…å­˜å®ç°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ task_repo_memory.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ activity_repo_memory.go
â”‚   â”‚   â”‚   â””â”€â”€ mysql/           # MySQLå®ç°ï¼ˆå¯æ‰©å±•ï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ task_repo_mysql.go
â”‚   â”‚   â”œâ”€â”€ notification/        # é€šçŸ¥æœåŠ¡é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ reach_adapter.go
â”‚   â”‚   â”‚   â””â”€â”€ email_adapter.go
â”‚   â”‚   â”œâ”€â”€ rule_engine/         # è§„åˆ™å¼•æ“é€‚é…å™¨
â”‚   â”‚   â”‚   â””â”€â”€ govaluate_adapter.go
â”‚   â”‚   â””â”€â”€ observer/            # è§‚å¯Ÿè€…å®ç°ï¼ˆäº‹ä»¶å¤„ç†ï¼‰
â”‚   â”‚       â”œâ”€â”€ subject.go
â”‚   â”‚       â”œâ”€â”€ task_detail_observer.go
â”‚   â”‚       â””â”€â”€ risk_check_observer.go
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚ï¼ˆFrameworks & Drivers Layerï¼‰
â”‚   â”‚   â”œâ”€â”€ config/              # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”‚   â”œâ”€â”€ logger/              # æ—¥å¿—
â”‚   â”‚   â”‚   â””â”€â”€ logger.go
â”‚   â”‚   â”œâ”€â”€ cache/               # ç¼“å­˜
â”‚   â”‚   â”‚   â””â”€â”€ redis.go
â”‚   â”‚   â”œâ”€â”€ database/            # æ•°æ®åº“
â”‚   â”‚   â”‚   â””â”€â”€ mysql.go
â”‚   â”‚   â””â”€â”€ lock/                # åˆ†å¸ƒå¼é”
â”‚   â”‚       â””â”€â”€ redis_lock.go
â”‚   â”‚
â”‚   â””â”€â”€ interface/               # æ¥å£å±‚ï¼ˆAPI/Controllerï¼‰
â”‚       â”œâ”€â”€ http/                # HTTPæ¥å£
â”‚       â”‚   â”œâ”€â”€ handler/         # HTTPå¤„ç†å™¨
â”‚       â”‚   â”‚   â””â”€â”€ task_handler.go
â”‚       â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚       â”‚   â”‚   â””â”€â”€ auth.go
â”‚       â”‚   â””â”€â”€ router/          # è·¯ç”±
â”‚       â”‚       â””â”€â”€ router.go
â”‚       â”œâ”€â”€ grpc/                # gRPCæ¥å£ï¼ˆå¯é€‰ï¼‰
â”‚       â”‚   â””â”€â”€ task_grpc.go
â”‚       â””â”€â”€ event/               # äº‹ä»¶ç›‘å¬å™¨
â”‚           â””â”€â”€ task_event_listener.go
â”‚
â”œâ”€â”€ pkg/                          # å…¬å…±åº“ï¼ˆå¯è¢«å¤–éƒ¨å¼•ç”¨ï¼‰
â”‚   â”œâ”€â”€ errors/                   # é”™è¯¯å®šä¹‰
â”‚   â”‚   â””â”€â”€ errors.go
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ time.go
â”‚   â””â”€â”€ constants/                # å¸¸é‡
â”‚       â””â”€â”€ constants.go
â”‚
â”œâ”€â”€ test/                         # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                     # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/              # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/                      # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md           # æ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ api.md                    # APIæ–‡æ¡£
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

## ğŸ“¦ å„å±‚èŒè´£è¯´æ˜

### 1. Domain Layerï¼ˆé¢†åŸŸå±‚ï¼‰
**ä½ç½®**ï¼š`internal/domain/`

**èŒè´£**ï¼š
- åŒ…å«ä¸šåŠ¡æ ¸å¿ƒé€»è¾‘å’Œè§„åˆ™
- å®šä¹‰å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸäº‹ä»¶
- å®šä¹‰ä»“å‚¨æ¥å£ï¼ˆä¸åŒ…å«å®ç°ï¼‰
- **ä¸ä¾èµ–ä»»ä½•å¤–å±‚**

**ç¤ºä¾‹**ï¼š
- `entity/task.go`ï¼šä»»åŠ¡å®ä½“çš„ä¸šåŠ¡é€»è¾‘
- `valueobject/task_type.go`ï¼šä»»åŠ¡ç±»å‹å€¼å¯¹è±¡
- `repository/task_repository.go`ï¼šä»»åŠ¡ä»“å‚¨æ¥å£å®šä¹‰

### 2. Use Case Layerï¼ˆç”¨ä¾‹å±‚ï¼‰
**ä½ç½®**ï¼š`internal/usecase/`

**èŒè´£**ï¼š
- ç¼–æ’ä¸šåŠ¡æµç¨‹
- åè°ƒé¢†åŸŸå¯¹è±¡å®Œæˆä¸šåŠ¡ç”¨ä¾‹
- å®šä¹‰è¾“å…¥/è¾“å‡ºç«¯å£
- ä¾èµ–é¢†åŸŸå±‚ï¼Œä¸ä¾èµ–å¤–å±‚

**ç¤ºä¾‹**ï¼š
- `task/trigger_task.go`ï¼šè§¦å‘ä»»åŠ¡ç”¨ä¾‹
- `port/output/task_repo.go`ï¼šä»»åŠ¡ä»“å‚¨ç«¯å£æ¥å£

### 3. Adapter Layerï¼ˆé€‚é…å™¨å±‚ï¼‰
**ä½ç½®**ï¼š`internal/adapter/`

**èŒè´£**ï¼š
- å®ç°ç”¨ä¾‹å±‚å®šä¹‰çš„è¾“å‡ºç«¯å£
- é€‚é…å¤–éƒ¨æœåŠ¡å’Œæ¡†æ¶
- æ•°æ®è½¬æ¢ï¼ˆé¢†åŸŸæ¨¡å‹ â†” æŒä¹…åŒ–æ¨¡å‹ï¼‰

**ç¤ºä¾‹**ï¼š
- `repository/memory/task_repo_memory.go`ï¼šå†…å­˜ä»“å‚¨å®ç°
- `notification/reach_adapter.go`ï¼šé€šçŸ¥æœåŠ¡é€‚é…å™¨
- `rule_engine/govaluate_adapter.go`ï¼šè§„åˆ™å¼•æ“é€‚é…å™¨

### 4. Infrastructure Layerï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
**ä½ç½®**ï¼š`internal/infrastructure/`

**èŒè´£**ï¼š
- æä¾›æŠ€æœ¯åŸºç¡€è®¾æ–½
- é…ç½®ã€æ—¥å¿—ã€ç¼“å­˜ã€æ•°æ®åº“è¿æ¥ç­‰
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

### 5. Interface Layerï¼ˆæ¥å£å±‚ï¼‰
**ä½ç½®**ï¼š`internal/interface/`

**èŒè´£**ï¼š
- å¤„ç†å¤–éƒ¨è¯·æ±‚ï¼ˆHTTPã€gRPCã€äº‹ä»¶ç­‰ï¼‰
- è°ƒç”¨ç”¨ä¾‹å±‚
- æ•°æ®æ ¡éªŒå’Œè½¬æ¢

## ğŸ”„ ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Interface Layer (HTTP/gRPC)     â”‚
â”‚         (Controller/Handler)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Use Case Layer (Application)     â”‚
â”‚        (Business Logic Orchestration)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer (Entities)        â”‚
â”‚          (Business Rules)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†‘
                 â”‚ implements
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Adapter Layer (Repositories)       â”‚
â”‚      (External Services Adapters)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ uses
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Infrastructure Layer (DB/Cache)      â”‚
â”‚    (Technical Details)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ é‡æ„ä¼˜åŠ¿

### å½“å‰æ¶æ„é—®é¢˜
1. âŒ `service` å±‚è€¦åˆäº†ä¸šåŠ¡é€»è¾‘å’ŒåŸºç¡€è®¾æ–½
2. âŒ `dao` å±‚ä¸ `model` å±‚æ··åˆ
3. âŒ ç¼ºå°‘æ¸…æ™°çš„ä¾èµ–è¾¹ç•Œ
4. âŒ éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•
5. âŒ éš¾ä»¥æ›¿æ¢å…·ä½“å®ç°ï¼ˆå¦‚æ•°æ®åº“ï¼‰

### é‡æ„åä¼˜åŠ¿
1. âœ… **æ¸…æ™°çš„ä¾èµ–æ–¹å‘**ï¼šå†…å±‚ç¨³å®šï¼Œå¤–å±‚å¯å˜
2. âœ… **é«˜åº¦å¯æµ‹è¯•**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•
3. âœ… **æŠ€æœ¯æ— å…³**ï¼šå¯è½»æ¾æ›¿æ¢æ•°æ®åº“ã€æ¡†æ¶
4. âœ… **æ˜“äºç»´æŠ¤**ï¼šèŒè´£æ˜ç¡®ï¼Œä¿®æ”¹å½±å“èŒƒå›´å°
5. âœ… **ä¾¿äºæ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ æ–°çš„ç”¨ä¾‹å’Œé€‚é…å™¨

## ğŸš€ è¿ç§»è®¡åˆ’

### Phase 1: é¢†åŸŸå±‚é‡æ„
1. æå–å®ä½“å¯¹è±¡ï¼ˆä» `model`ï¼‰
2. å®šä¹‰å€¼å¯¹è±¡
3. å®šä¹‰ä»“å‚¨æ¥å£

### Phase 2: ç”¨ä¾‹å±‚é‡æ„
1. æå–ä¸šåŠ¡ç”¨ä¾‹ï¼ˆä» `service`ï¼‰
2. å®šä¹‰è¾“å…¥/è¾“å‡ºç«¯å£
3. åˆ›å»º DTO

### Phase 3: é€‚é…å™¨å±‚é‡æ„
1. å®ç°ä»“å‚¨é€‚é…å™¨ï¼ˆä» `dao`ï¼‰
2. å®ç°è§„åˆ™å¼•æ“é€‚é…å™¨ï¼ˆä» `engine`ï¼‰
3. å®ç°è§‚å¯Ÿè€…é€‚é…å™¨ï¼ˆä» `observer`ï¼‰

### Phase 4: æ¥å£å±‚åˆ›å»º
1. åˆ›å»º HTTP å¤„ç†å™¨
2. åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨
3. æ·»åŠ ä¸­é—´ä»¶

### Phase 5: åŸºç¡€è®¾æ–½å®Œå–„
1. æ·»åŠ é…ç½®ç®¡ç†
2. æ·»åŠ æ—¥å¿—ç³»ç»Ÿ
3. æ·»åŠ åˆ†å¸ƒå¼é”

## ğŸ“ å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½å
- å°å†™ + ä¸‹åˆ’çº¿ï¼š`task_repository.go`
- æµ‹è¯•æ–‡ä»¶ï¼š`task_repository_test.go`

### åŒ…å‘½å
- å°å†™å•è¯ï¼š`package entity`
- é¿å…ç¼©å†™ï¼š`repository` è€Œé `repo`

### æ¥å£å‘½å
- åè¯æˆ–åŠ¨è¯ï¼š`TaskRepository`, `TaskService`
- ä¸ä½¿ç”¨ `I` å‰ç¼€

### å®ç°å‘½å
- å…·ä½“å®ç°å¸¦åç¼€ï¼š`TaskRepositoryMemory`, `TaskRepositoryMySQL`

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### é¢†åŸŸå±‚æµ‹è¯•
- çº¯å•å…ƒæµ‹è¯•
- æ— éœ€ Mock
- æµ‹è¯•ä¸šåŠ¡è§„åˆ™

### ç”¨ä¾‹å±‚æµ‹è¯•
- Mock è¾“å‡ºç«¯å£
- æµ‹è¯•ä¸šåŠ¡æµç¨‹ç¼–æ’

### é€‚é…å™¨å±‚æµ‹è¯•
- é›†æˆæµ‹è¯•
- æµ‹è¯•ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’

### æ¥å£å±‚æµ‹è¯•
- E2E æµ‹è¯•
- æµ‹è¯•å®Œæ•´æµç¨‹

## ğŸ“š å‚è€ƒèµ„æ–™

- [The Clean Architecture - Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/)
- [Domain-Driven Design](https://www.domainlanguage.com/ddd/)

